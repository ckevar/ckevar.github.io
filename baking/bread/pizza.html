<!DOCTYPE html>
<html>
<head>
	<title>Ultimate Pizza Calculator</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,700;1,600&display=swap" rel="stylesheet"> 
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script type="text/javascript" src="pizzaLan.json"></script>
</head>
<body>
	<div class="header">
		<h1><i>Pizza Calculator</i></h1>
		<select id="listLang" onchange="switchLanguage(this)">
		</select>
	</div>
<section class="pizza_main">
	<div class="pizza_container">

		<div class="pizza_col">
			<h2 id="settingsId">Settings</h2>
			<form>
				<label for="ovenType" id="ovenTypeId">OVEN</label>
				<select name="ovenType" onchange="ovenTypeFoo(this)" id="ovenTypeSelector">
					<option value="homeOven" id="homeOvenId" selected>Home Oven</option>
					<option value="woodFiredOven" id="woodFiredOvenId">Wood-fired Oven</option>
				</select>

				<label for="levainType" id="levainTypeId">LEAVEN</label>
				<select name="levainType" onchange="levainTypeFoo(this)" id="levainTypeSelector">
					<option value="dryYeast" id="dryYeastId" selected>Dry Yeast</option>
					<option value="freshYeast" id="freshYeastId">Fresh Yeast</option>
					<option value="biga" id="bigaId" disabled="">Biga</option>
					<option value="poolish" id="poolishId" disabled="">Poolish</option>
					<option value="sourdough" id="sourdoughId">Sourdough</option>
					<option value="motherYeast" id="motherYeastId">Mother yeast</option>
				</select>

				<label for="levainAmount" id="levainAmountId">LEVAIN AMOUNT [%]</label>
				<input type="range" name="levainAmount" id="levainAmountInId" min="40" max="60" value="40" onchange="levainAmountFoo(this)">

				<label for="pizzaWeight" id="pizzaWeightId">PIZZA WEIGHT [grams]</label>
				<input type="number" name="pizzaWeight" id="pizzaWeightInId" value="280" onchange="computePizza()">

				<label for="pizzaUnits" id="pizzaUnitsId">NUMBER OF PIZZAS</label>
				<input type="number" name="pizzaUnits" id="pizzaUnitsInId" value="1" min="1" onchange="computePizza()">

				<label for="pizzaHydration" id="pizzaHydrationId">HYDRATION [%]</label>
				<input type="range" name="pizzaHydration" id="pizzaHydrationInId" min="60" max="100" value="62.5" onchange="pizzaHydrationFoo(this)">

				<label for="pizzaSalt" id="pizzaSaltId">SALT [%]</label>
				<input type="range" name="pizzaSalt" id="pizzaSaltInId" min="20" max="30" value="26" onchange="pizzaSaltFoo(this)">

			</form>
		</div>

		<div class="pizza_col pizza_recipe">
			<h2 id="recipeId">Recipe</h2>
			<div class="pizzaIngredients">
				<div class="pizzaIngredient"> 
					<h3 id="flourId">Flour</h3>
					<p id="flourWeight">100g</p>
				</div>
				<div class="pizzaIngredient"> 
					<h3 id="waterId">Water</h3>
					<p id="waterWeight">62.3g</p>
				</div>
				<div class="pizzaIngredient">
					<h3 id="saltId">Salt</h3>
					<p id="saltWeight">2g</p>
				</div>

				<div class="pizzaIngredient">
					<h3 id="sugarId">Sugar</h3>
					<p id="sugarWeight">2g</p>
				</div>

				<div class="pizzaIngredient"> 
					<h3 id="levainName">Dry Yeast</h3>
					<p id="levainWeight">2g</p>
				</div>
				<div class="pizzaIngredient"> 
					<h3 id="fermentationTimeId">Fermentation Time</h3>
					<p id="fermentationTimeHours">2h</p>
				</div>
			</div>
		</div>
	</div>
</section>
<section class="footer">
	<div class="pizza_col">
		<h3>Reference</h3>
		<ul>
			<li><a href="https://www.pizzanapoletana.org/en/ricetta_pizza_napoletana">International regulations for Napolitan Pizza.</a></lu>
			<li><a href="https://blog.giallozafferano.it/dulcisinforno/pizza-bonci/">Amount of fresh yeast: Pizza Bonci, impasto per pizza lievitazione 24 ore.</a></lu>
			<li><a href="https://github.com/hendricius/pizza-dough">Pizza Dough.</a></li>
			<li><a href="https://pizza-calculator.the-bread-code.io/">Pizza Calculator (inspiration).</a></li>
			<li><a href="https://youtu.be/WidvoXBsDbI?t=939">Fermentation Time: 3 Secretos de un Pizzaiolo Napoletano.</a></lu>
			<li><a href="https://calcmasa.com/es/index.html">General Dough Calculator</a></lu>
		</ul>
	</div>
	<a href="https://ckevar.github.io"><i>ckevar</i></a>
</section>
<script type="text/javascript">
	var pizza = {};
	function placeNumbers(){
		ovenTypeFoo(document.getElementById("ovenTypeSelector"));
		levainTypeFoo(document.getElementById("levainTypeSelector"));
		pizzaSaltFoo(document.getElementById("pizzaSaltInId"));
		pizzaHydrationFoo(document.getElementById("pizzaHydrationInId"));
		levainAmountFoo(document.getElementById("levainAmountInId"));
	}

	window.onload = function () {
		const listLang = document.getElementById("listLang");
		for (var i = 0; i < pizzaVar.lang.length; i++) {
			const option = document.createElement("option");
			option.setAttribute("value", pizzaVar.lang[i].name);
			option.innerHTML = pizzaVar.lang[i].name;
			listLang.appendChild(option);
		}
		placeNumbers();
		computePizza();
	}

	function computePizza(){
		var numPizzas = document.getElementById("pizzaUnitsInId").value;
		pizza.wPizzas = document.getElementById("pizzaWeightInId").value * numPizzas;
		var twp = pizza.hydration + pizza.salt;
		
		if (pizza.oven == "homeOven")
			twp = twp + 2;

		if((pizza.leavenType == "freshYeast") || (pizza.leavenType == "dryYeast"))
			twp = twp + pizza.leavenAmount;

		twp = twp / 100 + 1;

		pizza.flour = pizza.wPizzas / twp;
		pizza.salty = Math.round(pizza.flour * pizza.salt / 100);
		pizza.sugar = Math.round(pizza.flour * 2 / 100);
		pizza.water = pizza.flour * pizza.hydration / 100;

		if ((pizza.leavenType == "sourdough")) {
			pizza.yeast = Math.round(pizza.flour * pizza.leavenAmount / 100);
			pizza.flour = (pizza.flour - pizza.yeast / 2);
			pizza.water = (pizza.water - pizza.yeast / 2);
		} else if (pizza.leavenType == "motherYeast") {
			pizza.yeast = Math.round(pizza.flour * pizza.leavenAmount / 100);
			if((pizza.yeast % 3) == 1) 
				pizza.yeast = pizza.yeast - 1;
			else if ((pizza.yeast % 3) == 2) 
				pizza.yeast = pizza.yeast + 1;
			pizza.flour = (pizza.flour - pizza.yeast * 2 / 3);
			pizza.water = (pizza.water - pizza.yeast * 1 / 3);
		} else {
			pizza.yeast = (pizza.flour * pizza.leavenAmount / 100);
			// fresh yeast = (gr_flour x 23) / (percentage_hydration * fermentation_hour * ferementation_temperature);
			pizza.ft = pizza.flour * 23 / (pizza.hydration * 4 * pizza.yeast)
			if (pizza.leavenType == "dryYeast")
				pizza.ft = pizza.ft / 3;

			document.getElementById("fermentationTimeHours").innerHTML = pizza.ft.toPrecision(4)+'h';
		}
		pizza.flour = Math.round(pizza.flour);
		pizza.water = Math.round(pizza.water);

		document.getElementById("flourWeight").innerHTML = pizza.flour.toString() + 'g';
		document.getElementById("waterWeight").innerHTML = pizza.water.toString() + 'g';
		document.getElementById('saltWeight').innerHTML = pizza.salty.toString() + 'g';
		document.getElementById('sugarWeight').innerHTML = pizza.sugar.toString() + 'g';
		document.getElementById('levainWeight').innerHTML = pizza.yeast.toPrecision(3) + 'g';
	}
	function pizzaSaltFoo(arg) {
		val = arg.value / 10;
		pizza.salt = val;
		document.getElementById("pizzaSaltId").innerHTML = pizzaVar.lang[pizzaVar.langDefault].content.pizzaSalt.label + ' ' + val.toString();
		computePizza();
	}
	function pizzaHydrationFoo(arg) {
		val = arg.value;
		pizza.hydration = Number(val);
		document.getElementById("pizzaHydrationId").innerHTML = pizzaVar.lang[pizzaVar.langDefault].content.pizzaHydration.label + ' ' + val.toString();
		computePizza();
	}
	function levainAmountFoo(arg) {
		const levtype = document.getElementById("levainTypeSelector").value;
		var val = 0;
		if((levtype == "freshYeast") || levtype == "dryYeast")
			val = arg.value / 100;
		else 
			val = arg.value;
		document.getElementById("levainAmountId").innerHTML = pizzaVar.lang[pizzaVar.langDefault].content.levainAmount.label + ' ' + val.toString();
		pizza.leavenType = levtype;
		pizza.leavenAmount = val;
		computePizza();
	}

	function levainTypeFoo(selector) {

		document.getElementById("levainName").innerHTML = pizzaVar.lang[pizzaVar.langDefault].content.levainType.option[selector.selectedIndex];
		const levainAmnt = document.getElementById("levainAmountInId");
		document.getElementById("fermentationTimeHours").style.display = 'block';
		document.getElementById("fermentationTimeId").style.display = 'block';
		if(selector.value == "freshYeast") {
			levainAmnt.min = 40;
			levainAmnt.max = 60;

		} else if (selector.value == "dryYeast") {
			levainAmnt.min = 13;
			levainAmnt.max = 20;
		}
		else if ((selector.value == "sourdough") || (selector.value == "motherYeast")) {
			levainAmnt.min = 10;
			levainAmnt.max = 20;
			document.getElementById("fermentationTimeHours").style.display = 'none';
			document.getElementById("fermentationTimeId").style.display = 'none';

		}
		levainAmountFoo(levainAmnt);
		computePizza();

	}
	function ovenTypeFoo(selector) {
		if (selector.value == "homeOven") {
			document.getElementById("sugarId").style.display = "block";
			document.getElementById("sugarWeight").style.display = "block";
		} else if (selector.value == "woodFiredOven") {
			document.getElementById("sugarId").style.display = "none";
			document.getElementById("sugarWeight").style.display = "none";
		}
		pizza.oven = selector.value;
		computePizza();
	}
	function switchLanguage(listLang) {
		for (var i = pizzaVar.lang.length - 1; i >= 0; i--) {
			if (pizzaVar.lang[i].name == listLang.value) {
				pizzaVar.langDefault = i;
				break;
			}
		}
		const j = pizzaVar.langDefault;
		document.getElementById("settingsId").innerHTML = pizzaVar.lang[j].content.settings;
		document.getElementById("ovenTypeId").innerHTML = pizzaVar.lang[j].content.ovenType.label;
		document.getElementById("homeOvenId").innerHTML = pizzaVar.lang[j].content.ovenType.option[0];
		document.getElementById("woodFiredOvenId").innerHTML = pizzaVar.lang[j].content.ovenType.option[1];
		document.getElementById("levainTypeId").innerHTML = pizzaVar.lang[j].content.levainType.label;
		document.getElementById("dryYeastId").innerHTML = pizzaVar.lang[j].content.levainType.option[0]
		document.getElementById("freshYeastId").innerHTML = pizzaVar.lang[j].content.levainType.option[1];
		document.getElementById("bigaId").innerHTML = pizzaVar.lang[j].content.levainType.option[2];
		document.getElementById("poolishId").innerHTML = pizzaVar.lang[j].content.levainType.option[3];
		document.getElementById("sourdoughId").innerHTML = pizzaVar.lang[j].content.levainType.option[4];
		document.getElementById("motherYeastId").innerHTML = pizzaVar.lang[j].content.levainType.option[5];
		document.getElementById("levainAmountId").innerHTML = pizzaVar.lang[j].content.levainAmount.label;
		document.getElementById("pizzaWeightId").innerHTML = pizzaVar.lang[j].content.pizzaWeight.label;
		document.getElementById("pizzaUnitsId").innerHTML = pizzaVar.lang[j].content.pizzaUnits.label;
		document.getElementById("pizzaHydrationId").innerHTML = pizzaVar.lang[j].content.pizzaHydration.label;
		document.getElementById("recipeId").innerHTML = pizzaVar.lang[j].content.recipe;
		document.getElementById("pizzaSaltId").innerHTML = pizzaVar.lang[j].content.pizzaSalt.label;
		document.getElementById("flourId").innerHTML = pizzaVar.lang[j].content.ingredients[0];
		document.getElementById("waterId").innerHTML = pizzaVar.lang[j].content.ingredients[1];
		document.getElementById("saltId").innerHTML = pizzaVar.lang[j].content.ingredients[2];
		document.getElementById("sugarId").innerHTML = pizzaVar.lang[j].content.ingredients[3]
		document.getElementById("fermentationTimeId").innerHTML = pizzaVar.lang[j].content.ingredients[4];
		const selector = document.getElementById("levainTypeSelector"); 
		document.getElementById("levainName").innerHTML = pizzaVar.lang[pizzaVar.langDefault].content.levainType.option[selector.selectedIndex];
		placeNumbers();
	}

</script>
</body>
</html>