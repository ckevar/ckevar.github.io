<!DOCTYPE html>
<html>
<head>
	<title>Ultimate Pizza Calculator</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,700;1,600&display=swap" rel="stylesheet"> 
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script type="text/javascript" src="pizzaLan.json"></script>
</head>
<body>
	<div class="header">
		<h1><i>Pizza Calculator</i></h1>
		<select id="listLang" onchange="switchLanguage(this)">
		</select>
	</div>
<section class="pizza_main">
	<div class="pizza_container">

		<div class="pizza_col">
			<h2 id="settingsId">Settings</h2>
			<form>

				<!-- 
				<label for="presets" id="presetsId">PRESETS</label>
				<select name="presets" onchange="presetsFoo(this)" id="presetsSelectorId">
					<option value="" id="minePizzaId" selected disabled="">Click here If you have no idea</option>
					<optgroup label="Pizza">
						<option value="bonciPizza" id="bonciPizzaId">Bonci</option>
						<option value="cAlvaradoPizza" id="CAlvaradoPizzaId">C. Alvarado</option>
						<option value="vIacopeeliPizza" id="VIacopeeliPizzaId">V. Iacopelli</option>
						<option value="vIacopeeliPizzaBiga" id="VIacopeeliPizzaBigaId">V. Iacopelli - Biga</option>
						<option value="vIacopeeliPizzaPoolish" id="VIacopeeliPizzaPoolishId">V. Iacopelli - Poolish</option>
					</optgroup>
					<optgroup label="Pinsa">
						<option value="vAlvaradoPinsa" id="CAlvaradoPinsaId">C. Alvarado</option>
						<option value="gZafferanoPinsa" id="GZafferanoPinsaId">G. Zafferano</option>
						<option value="mMontuoriPinsa" id="MMontuoriPinsaId">M. Montuori</option>
					</optgroup>
					<optgroup label="Focaccia">
						<option value="cAlvaradoFocaccia" id="CAlvaradoFocacciaId">C. Alvarado</option>
						<option value="gZafferanoFocaccia" id="GZafferanoFocacciaId">G. Zafferano</option>
					</optgroup>
					<option value="" id="customId" >Custome</option>
				</select> -->

				<label for="ovenType" id="ovenTypeId">OVEN</label>
				<select name="ovenType" onchange="ovenTypeFoo(this)" id="ovenTypeSelector">
					<option value="homeOven" id="homeOvenId" selected>Home Oven</option>
					<option value="woodFiredOven" id="woodFiredOvenId">Wood-fired Oven</option>
				</select>

				<label for="levainType" id="levainTypeId">LEAVEN</label>
				<select name="levainType" onchange="leavenTypeFoo(this)" id="levainTypeSelector">
					<option value="dryYeast" id="dryYeastId" selected>Dry Yeast</option>
					<option value="freshYeast" id="freshYeastId">Fresh Yeast</option>
					<option value="biga" id="bigaId" disabled="">Biga</option>
					<option value="poolish" id="poolishId" disabled="">Poolish</option>
					<option value="sourdough" id="sourdoughId">Sourdough</option>
					<option value="motherYeast" id="motherYeastId">Mother yeast</option>
				</select>

				<label for="levainAmount" id="levainAmountId">LEVAIN AMOUNT [%]</label>
				<input type="range" name="levainAmount" id="levainAmountInId" min="40" max="60" value="40" onchange="leavenAmountFoo(this)">

				<label for="pizzaWeight" id="pizzaWeightId">PIZZA WEIGHT [grams]</label>
				<input type="number" name="pizzaWeight" id="pizzaWeightInId" value="280" onchange="computePizza()">

				<label for="pizzaUnits" id="pizzaUnitsId">NUMBER OF PIZZAS</label>
				<input type="number" name="pizzaUnits" id="pizzaUnitsInId" value="1" min="1" onchange="computePizza()">

				<label for="pizzaHydration" id="pizzaHydrationId">HYDRATION [%]</label>
				<input type="range" name="pizzaHydration" id="pizzaHydrationInId" min="60" max="100" value="62.5" onchange="pizzaHydrationFoo(this)">

				<label for="pizzaSalt" id="pizzaSaltId">SALT [%]</label>
				<input type="range" name="pizzaSalt" id="pizzaSaltInId" min="20" max="30" value="26" onchange="pizzaSaltFoo(this)">

			</form>
		</div>

		<div class="pizza_col pizza_recipe">
			<!-- 
			<h2 id="prefermentId">Preferment</h2>
			<div id="prefermentIngredientsId">
				<div class="pizzaIngredient"> 
					<h3 id="prefermentFlourId">Flour</h3>
					<p id="prefermentFlourWeight">100g</p>
				</div>
				<div class="pizzaIngredient"> 
					<h3 id="prefermentWaterId">Water</h3>
					<p id="prefermentflourWeight">100g</p>
				</div>
				<div class="pizzaIngredient"> 
					<h3 id="prefermentWaterId">Yeast</h3>
					<p id="prefermentflourWeight">100g</p>
				</div>
				<div class="pizzaIngredient"> 
					<h3 id="prefermentWaterId">Sugar/Honey</h3>
					<p id="prefermentflourWeight">10g</p>
				</div>
			</div> -->
			<h2 id="recipeId">Dough</h2>
			<div>
				<div class="pizzaIngredient"> 
					<h3 id="flourId">Flour</h3>
					<p id="flourWeight">100g</p>
				</div>
				<div class="pizzaIngredient"> 
					<h3 id="waterId">Water</h3>
					<p id="waterWeight">62.3g</p>
				</div>
				<div class="pizzaIngredient">
					<h3 id="saltId">Salt</h3>
					<p id="saltWeight">2g</p>
				</div>

				<div class="pizzaIngredient">
					<h3 id="sugarId">Sugar</h3>
					<p id="sugarWeight">2g</p>
				</div>

				<div class="pizzaIngredient"> 
					<h3 id="levainName">Dry Yeast</h3>
					<p id="levainWeight">2g</p>
				</div>
				<div class="pizzaIngredient"> 
					<h3 id="fermentationTimeId">Fermentation Time</h3>
					<p id="fermentationTimeHours">2h</p>
				</div>
				<div class="pizzaIngredient"> 
					<h3 id="noteTitleId">Note</h3>
					<p id="noteContentId">...</p>
				</div>
			</div>
		</div>
	</div>
</section>
<section class="footer">
	<div class="pizza_col">
		<h3>Reference</h3>
		<ul>
			<li><a href="https://www.pizzanapoletana.org/en/ricetta_pizza_napoletana">International regulations for Napolitan Pizza.</a></lu>
			<li><a href="https://blog.giallozafferano.it/dulcisinforno/pizza-bonci/">Pizza Bonci, impasto per pizza lievitazione 24 ore.</a></lu>
			<li><a href="https://github.com/hendricius/pizza-dough">Pizza Dough.</a></li>
			<li><a href="https://pizza-calculator.the-bread-code.io/">Pizza Calculator (inspiration).</a></li>
			<li><a href="https://youtu.be/WidvoXBsDbI?t=939">Fermentation Time: 3 Secretos de un Pizzaiolo Napoletano.</a></li>
			<li><a href="https://calcmasa.com/es/index.html">General Dough Calculator</a></li>
			<li><a href="https://www.youtube.com/watch?v=Qbw5DUDK7Fs">Biga-based Pizza</a></li>
			<li><a href="https://www.youtube.com/c/vitoiacopelli">Poolish-based Pizza</a></li>
			<li><a href="https://www.youtube.com/watch?v=C3Gtsc6u5pU">Pinsa Romana con Mauro Montuori</a></li>
			<li><a href="https://ricette.giallozafferano.it/Pinsa-romana.html">Giallo Zafferano's Pinsa Romana</a></li>
		</ul>
	</div>
	<a href="https://ckevar.github.io"><i>ckevar</i></a>
</section>

<script type="text/javascript">
	let pizza = {
		weight: {}, 
		percentage: {
			oil: 0, 
			sugar: 0}
		};


	function placeNumbers(){
		ovenTypeFoo(document.getElementById("ovenTypeSelector"));
		leavenTypeFoo(document.getElementById("levainTypeSelector"));
		pizzaSaltFoo(document.getElementById("pizzaSaltInId"));
		pizzaHydrationFoo(document.getElementById("pizzaHydrationInId"));
		leavenAmountFoo(document.getElementById("levainAmountInId"));
	}

	function themeSelector(themeIdx){
		if (themeIdx != null) {theme = themeIdx;}
		else theme = Math.floor(Math.random() * 6).toString();
		
		document.documentElement.style.setProperty('--main-dark-color',pizzaVar.theme[theme].dark);
		document.documentElement.style.setProperty('--main-middle-color',pizzaVar.theme[theme].clear);
		document.documentElement.style.setProperty('--font-color-in-middle-background',pizzaVar.theme[theme].font);
		document.documentElement.style.setProperty('--footer-color',pizzaVar.theme[theme].footer);
	}

	window.onload = function () {
		const listLang = document.getElementById("listLang");

		for (var i = pizzaVar.lang.available.length - 1; i >= 0; i--) {
			const option = document.createElement("option");
			option.setAttribute("value", pizzaVar.lang.available[i].val);
			option.innerHTML = pizzaVar.lang.available[i].name;
			listLang.appendChild(option);
		}
		switchLanguage(listLang);
		themeSelector(1);
		placeNumbers();
		computePizza();
	}

	function computePizza(){
		var numPizzas = document.getElementById("pizzaUnitsInId").value;

		pizza.percentage.flour = 100;

		pizza.weight.total = document.getElementById("pizzaWeightInId").value * numPizzas;
		pizza.percentage.total = pizza.percentage.flour + pizza.percentage.hydration + pizza.percentage.salt;

		if (pizza.percentage.oil == 0) 
			pizza.percentage.sugar = 2;

		if (pizza.oven == "homeOven")
			pizza.percentage.total = pizza.percentage.total + pizza.percentage.sugar + pizza.percentage.oil;

		if((pizza.leavenType == "freshYeast") || (pizza.leavenType == "dryYeast"))
			pizza.percentage.total = pizza.percentage.total + pizza.percentage.leaven;

		pizza.percentage.total = pizza.percentage.total / 100;

		pizza.weight.flour = pizza.weight.total / pizza.percentage.total;
		pizza.weight.salt = Math.round(pizza.weight.flour * pizza.percentage.salt / 100);
		pizza.weight.sugar = Math.round(pizza.weight.flour * pizza.percentage.sugar / 100);
		pizza.weight.water = pizza.weight.flour * pizza.percentage.hydration / 100;

		if ((pizza.leavenType == "sourdough")) {
			pizza.weight.yeast = Math.round(pizza.weight.flour * pizza.percentage.leaven / 100);
			pizza.weight.flour = (pizza.weight.flour - pizza.weight.yeast / 2);
			pizza.weight.water = (pizza.weight.water - pizza.weight.yeast / 2);

		} else if (pizza.leavenType == "motherYeast") {
			pizza.weight.yeast = Math.round(pizza.weight.flour * pizza.percentage.leaven / 100);
			if((pizza.weight.yeast % 3) == 1) 
				pizza.weight.yeast = pizza.weight.yeast - 1;
			else if ((pizza.weight.yeast % 3) == 2) 
				pizza.weight.yeast = pizza.weight.yeast + 1;
			pizza.weight.flour = (pizza.weight.flour - pizza.weight.yeast * 2 / 3);
			pizza.weight.water = (pizza.weight.water - pizza.weight.yeast * 1 / 3);

		} else {
			pizza.weight.yeast = (pizza.weight.flour * pizza.percentage.leaven / 100);
			// fresh yeast = (gr_flour x 23) / (percentage_hydration * fermentation_hour * ferementation_temperature);
			pizza.ft = pizza.weight.flour * 23 / (pizza.percentage.hydration * 4 * pizza.weight.yeast)
			if (pizza.leavenType == "dryYeast")
				pizza.ft = pizza.ft / 3;

			document.getElementById("fermentationTimeHours").innerHTML = pizza.ft.toPrecision(4)+'h';
		}
		pizza.weight.flour = Math.round(pizza.weight.flour);
		pizza.weight.water = Math.round(pizza.weight.water);

		document.getElementById("flourWeight").innerHTML = pizza.weight.flour.toString() + 'g';
		document.getElementById("waterWeight").innerHTML = pizza.weight.water.toString() + 'g';
		document.getElementById('saltWeight').innerHTML = pizza.weight.salt.toString() + 'g';
		document.getElementById('sugarWeight').innerHTML = pizza.weight.sugar.toString() + 'g';
		document.getElementById('levainWeight').innerHTML = pizza.weight.yeast.toPrecision(3) + 'g';
	}

	/*Input Reaction Functions*/
	function presetsFoo(selector) {
		function loadValuesIntoUI () {
			document.getElementById("ovenTypeSelector").value = pizza.oven;
			document.getElementById("pizzaWeightInId").value = pizza.weight.total;

			/***********************/
			tmpElement = document.getElementById("pizzaHydrationInId");
			tmpElement.value = pizza.percentage.hydration;
			pizzaHydrationFoo(tmpElement);
			
			/***********************/
			tmpElement = document.getElementById("pizzaSaltInId");
			tmpElement.value = pizza.percentage.salt * 10;	// Re-arrenges the scale 
			pizzaSaltFoo(tmpElement);

			/***********************/
			var tmpElement = document.getElementById("levainTypeSelector");
			var minmax = returnLeavenAmount(pizza.leavenType);
			tmpElement.value = pizza.leavenType;

			tmpElement = document.getElementById("levainAmountInId");
			tmpElement.min = minmax[0];
			tmpElement.max = minmax[1];
			if (pizza.leavenType == "freshYeast" || pizza.leavenType == "dryYeast") {
				// Since Input-Range only allows int numbers and the yeast amount can 
				// go from below 1, it's better to multiply it by 100;
				tmpElement.value = (pizza.percentage.leaven * 100).toString();
			} else {
				tmpElement.value = pizza.percentage.leaven;
			}
			leavenAmountFoo(tmpElement);

			/***********************/
			if(pizza.preferment) {
				document.getElementById("prefermentId").style.display = "block";
				document.getElementById("prefermentIngredientsId").style.display = "block";
			} else {
				document.getElementById("prefermentId").style.display = "none";
				document.getElementById("prefermentIngredientsId").style.display = "none";
			}


		}

		if (selector.value == "bonciPizza") {
			pizza = pizzaVar.presets.pizza.bonci.features;
			loadValuesIntoUI();

		} else if (selector.value == "cAlvaradoPizza") {
			pizza = pizzaVar.presets.pizza.cAlvarado.features;
			loadValuesIntoUI();

		} else if (selector.value == "vIacopeeliPizzaBiga") {
			pizza = pizzaVar.presets.pizza.vIacopeeliBiga.features;
		}
	}
	function pizzaSaltFoo(arg) {
		val = arg.value / 10;
		pizza.percentage.salt = val;
		document.getElementById("pizzaSaltId").innerHTML = pizzaVar.lang[pizzaVar.lang.default].pizzaSalt.label + ' ' + val.toString();
		computePizza();
	}
	function pizzaHydrationFoo(arg) {
		val = arg.value;
		pizza.percentage.hydration = Number(val);
		document.getElementById("pizzaHydrationId").innerHTML = pizzaVar.lang[pizzaVar.lang.default].pizzaHydration.label + ' ' + val;
		computePizza();
	}
	function leavenAmountFoo(arg) {
		const levtype = document.getElementById("levainTypeSelector").value;
		var val = Number(arg.value);
		if((levtype == "freshYeast") || levtype == "dryYeast")
			val = val / 100;

		document.getElementById("levainAmountId").innerHTML = pizzaVar.lang[pizzaVar.lang.default].levainAmount.label + ' ' + val.toString();
		pizza.leavenType = levtype;
		pizza.percentage.leaven = val;
		computePizza();
	}

	function returnLeavenAmount(value) {
		var minmax = [];
		if(value == "freshYeast") {
			minmax[0] = 40;
			minmax[1] = 60;

		} else if (value == "dryYeast") {
			minmax[0] = 13;
			minmax[1] = 20;
		}
		else if ((value == "sourdough") || (value == "motherYeast")) {
			minmax[0] = 10;
			minmax[1] = 20;
			document.getElementById("fermentationTimeHours").style.display = 'none';
			document.getElementById("fermentationTimeId").style.display = 'none';
		}
		return minmax;
	}

	function leavenTypeFoo(selector) {

		document.getElementById("levainName").innerHTML = pizzaVar.lang[pizzaVar.lang.default].levainType.option[selector.selectedIndex];
		const levainAmnt = document.getElementById("levainAmountInId");
		document.getElementById("fermentationTimeHours").style.display = 'block';
		document.getElementById("fermentationTimeId").style.display = 'block';

		const minmax = returnLeavenAmount(selector.value);

		levainAmnt.min = minmax[0];
		levainAmnt.max = minmax[1];

		leavenAmountFoo(levainAmnt);
		computePizza();

	}
	function ovenTypeFoo(selector) {
		if (selector.value == "homeOven") {
			document.getElementById("sugarId").style.display = "block";
			document.getElementById("sugarWeight").style.display = "block";

		} else if (selector.value == "woodFiredOven") {
			document.getElementById("sugarId").style.display = "none";
			document.getElementById("sugarWeight").style.display = "none";
		}
		pizza.oven = selector.value;
		computePizza();
	}
	function switchLanguage(listLang) {
		if(listLang.value)
			pizzaVar.lang.default = listLang.value;
		const j = pizzaVar.lang.default;
		document.getElementById("settingsId").innerHTML = pizzaVar.lang[j].settings;
		document.getElementById("ovenTypeId").innerHTML = pizzaVar.lang[j].ovenType.label;
		document.getElementById("homeOvenId").innerHTML = pizzaVar.lang[j].ovenType.option[0];
		document.getElementById("woodFiredOvenId").innerHTML = pizzaVar.lang[j].ovenType.option[1];
		document.getElementById("levainTypeId").innerHTML = pizzaVar.lang[j].levainType.label;
		document.getElementById("dryYeastId").innerHTML = pizzaVar.lang[j].levainType.option[0]
		document.getElementById("freshYeastId").innerHTML = pizzaVar.lang[j].levainType.option[1];
		document.getElementById("bigaId").innerHTML = pizzaVar.lang[j].levainType.option[2];
		document.getElementById("poolishId").innerHTML = pizzaVar.lang[j].levainType.option[3];
		document.getElementById("sourdoughId").innerHTML = pizzaVar.lang[j].levainType.option[4];
		document.getElementById("motherYeastId").innerHTML = pizzaVar.lang[j].levainType.option[5];
		document.getElementById("levainAmountId").innerHTML = pizzaVar.lang[j].levainAmount.label;
		document.getElementById("pizzaWeightId").innerHTML = pizzaVar.lang[j].pizzaWeight.label;
		document.getElementById("pizzaUnitsId").innerHTML = pizzaVar.lang[j].pizzaUnits.label;
		document.getElementById("pizzaHydrationId").innerHTML = pizzaVar.lang[j].pizzaHydration.label;
		document.getElementById("recipeId").innerHTML = pizzaVar.lang[j].recipe;
		document.getElementById("pizzaSaltId").innerHTML = pizzaVar.lang[j].pizzaSalt.label;
		document.getElementById("flourId").innerHTML = pizzaVar.lang[j].ingredients[0];
		document.getElementById("waterId").innerHTML = pizzaVar.lang[j].ingredients[1];
		document.getElementById("saltId").innerHTML = pizzaVar.lang[j].ingredients[2];
		document.getElementById("sugarId").innerHTML = pizzaVar.lang[j].ingredients[3]
		document.getElementById("fermentationTimeId").innerHTML = pizzaVar.lang[j].ingredients[4];
		const selector = document.getElementById("levainTypeSelector"); 
		document.getElementById("levainName").innerHTML = pizzaVar.lang[pizzaVar.lang.default].levainType.option[selector.selectedIndex];
		placeNumbers();
	}

</script>
</body>
</html>